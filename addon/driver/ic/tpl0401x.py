from mix.driver.core.bus.i2c import I2C
from mix.driver.core.bus.i2c_bus_emulator import I2CEmulator


class TPL0401xDef:
    RESISTANCE = {
        0: 0x00,
        0.08: 0x01,
        0.16: 0x02,
        0.23: 0x03,
        0.31: 0x04,
        0.39: 0x05,
        0.47: 0x06,
        0.55: 0x07,
        0.63: 0x08,
        0.7: 0x09,
        0.78: 0x0A,
        0.86: 0x0B,
        0.94: 0x0C,
        1.02: 0x0D,
        1.09: 0x0E,
        1.17: 0x0F,
        1.25: 0x10,
        1.33: 0x11,
        1.41: 0x12,
        1.48: 0x13,
        1.56: 0x14,
        1.64: 0x15,
        1.72: 0x16,
        1.8: 0x17,
        1.88: 0x18,
        1.95: 0x19,
        2.03: 0x1A,
        2.11: 0x1B,
        2.19: 0x1C,
        2.27: 0x1D,
        2.34: 0x1E,
        2.42: 0x1F,
        2.5: 0x20,
        2.58: 0x21,
        2.66: 0x22,
        2.73: 0x23,
        2.81: 0x24,
        2.89: 0x25,
        2.97: 0x26,
        3.05: 0x27,
        3.13: 0x28,
        3.2: 0x29,
        3.28: 0x2A,
        3.36: 0x2B,
        3.44: 0x2C,
        3.52: 0x2D,
        3.59: 0x2E,
        3.67: 0x2F,
        3.75: 0x30,
        3.83: 0x31,
        3.91: 0x32,
        3.98: 0x33,
        4.06: 0x34,
        4.14: 0x35,
        4.22: 0x36,
        4.3: 0x37,
        4.38: 0x38,
        4.45: 0x39,
        4.53: 0x3A,
        4.61: 0x3B,
        4.69: 0x3C,
        4.77: 0x3D,
        4.84: 0x3E,
        4.92: 0x3F,
        5: 0x40,
        5.08: 0x41,
        5.16: 0x42,
        5.23: 0x43,
        5.31: 0x44,
        5.39: 0x45,
        5.47: 0x46,
        5.55: 0x47,
        5.63: 0x48,
        5.7: 0x49,
        5.78: 0x4A,
        5.86: 0x4B,
        5.94: 0x4C,
        6.02: 0x4D,
        6.09: 0x4E,
        6.17: 0x4F,
        6.25: 0x50,
        6.33: 0x51,
        6.41: 0x52,
        6.48: 0x53,
        6.56: 0x54,
        6.64: 0x55,
        6.72: 0x56,
        6.8: 0x57,
        6.88: 0x58,
        6.95: 0x59,
        7.03: 0x5A,
        7.11: 0x5B,
        7.19: 0x5C,
        7.27: 0x5D,
        7.34: 0x5E,
        7.42: 0x5F,
        7.5: 0x60,
        7.58: 0x61,
        7.66: 0x62,
        7.73: 0x63,
        7.81: 0x64,
        7.89: 0x65,
        7.97: 0x66,
        8.05: 0x67,
        8.13: 0x68,
        8.2: 0x69,
        8.28: 0x6A,
        8.36: 0x6B,
        8.44: 0x6C,
        8.52: 0x6D,
        8.59: 0x6E,
        8.67: 0x6F,
        8.75: 0x70,
        8.83: 0x71,
        8.91: 0x72,
        8.98: 0x73,
        9.06: 0x74,
        9.14: 0x75,
        9.22: 0x76,
        9.3: 0x77,
        9.38: 0x78,
        9.45: 0x79,
        9.53: 0x7A,
        9.61: 0x7B,
        9.69: 0x7C,
        9.77: 0x7D,
        9.84: 0x7E,
        9.92: 0x7F,
    }

    DEV_ADDR = [
        0x2E, 0x3E
    ]


class TPL0401x(object):
    def __init__(self, dev_addr, i2c_bus):
        # assert dev_addr in TPL0401xDef.DEV_ADDR
        self.__dev_addr = dev_addr
        self.i2c_bus = i2c_bus

    def read_register(self):
        return self.i2c_bus.read(self.__dev_addr, 1)[0]

    def set_resistance(self, resistance):
        assert resistance in TPL0401xDef.RESISTANCE.keys()
        data = [0x00, TPL0401xDef.RESISTANCE[resistance]]
        self.i2c_bus.write(self.__dev_addr, data)
